---
layout: artifacts
title: ç”»åƒãƒˆãƒªãƒŸãƒ³ã‚°ï¼†åº§æ¨™å–å¾—ãƒ„ãƒ¼ãƒ«
---

<!-- è¿½åŠ : åº§æ¨™è¡¨ç¤ºç”¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆå¤§ãããƒ»ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ãƒ»æˆåŠŸãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰ -->
<style>
	/* ...æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒã‚ã‚Œã°ãã®ã¾ã¾... */
	.coordinate-display {
		display: flex;
		align-items: center;
		gap: 8px;
		flex-wrap: wrap;
	}
	.coordinate-text {
		font-size: 1.25rem; /* å¤§ãã‚è¡¨ç¤º */
		padding: 8px 12px;
		border-radius: 6px;
		background: #f8f9fb;
		border: 1px solid #e1e6ef;
		cursor: pointer;
		color: #222;
		text-align: center;
		white-space: nowrap;
	}
	.coordinate-text:active { transform: translateY(1px); }
	.copy-btn { /* ã‚³ãƒ”ãƒ¼ç”¨å°ãƒœã‚¿ãƒ³ */
		padding: 6px 10px;
		border-radius: 6px;
		cursor: pointer;
	}
	.copy-success {
		background: #e6ffea !important;
		color: #0b7a2a !important;
		border-color: #bfeec9 !important;
	}
</style>

    <div class="container">
		<h1>ğŸ–¼ï¸ ç”»åƒãƒˆãƒªãƒŸãƒ³ã‚°ï¼†åº§æ¨™å–å¾—ãƒ„ãƒ¼ãƒ«</h1>
        
        <div class="instructions">
            <h3>ä½¿ã„æ–¹</h3>
            <ul>
                <li>ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€Poke-Controllerã®isContainTemplateé–¢æ•°ç”¨ã®ç”»åƒã®åˆ‡ã‚ŠæŠœãã¨cropç¯„å›²æŒ‡å®šã‚’è¡Œã„ã¾ã™</li>
                <li>ç”»åƒã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã‹ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</li>
                <li>ç”»åƒä¸Šã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ãƒˆãƒªãƒŸãƒ³ã‚°ç¯„å›²ã‚’é¸æŠã€ãƒˆãƒªãƒŸãƒ³ã‚°å®Ÿè¡Œã‚’æŠ¼ã™</li>
                <li>cropç¯„å›²åº§æ¨™ã‚’ [l, t, r, b] å½¢å¼ã§ã‚³ãƒ”ãƒ¼</li>
                <li>åˆ‡ã‚ŠæŠœãç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã§å–å¾—</li>
            </ul>
            
            
        </div>

        <div class="upload-area" id="uploadArea">
            <div class="upload-text">ğŸ“ ç”»åƒã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</div>
            <div>ã¾ãŸã¯</div>
            <button class="toggle-btn" onclick="document.getElementById('fileInput').click()">
                ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
            </button>
            <input type="file" id="fileInput" class="file-input" accept="image/*">
        </div>

        <div class="canvas-container" id="canvasContainer">
            <canvas id="imageCanvas"></canvas>
        </div>

        <div class="controls" id="controls">
            <button class="toggle-btn" id="cropBtn" disabled>ãƒˆãƒªãƒŸãƒ³ã‚°å®Ÿè¡Œ</button>
            <button class="toggle-btn" id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>

        <div class="info-panel" id="infoPanel">
            <h3>ğŸ“ åº§æ¨™æƒ…å ± [l, t, r, b]</h3>
            <div class="coordinate-display" id="coordinateDisplay">
                <!-- åˆæœŸè¡¨ç¤ºã¯ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ãªè¦ç´ ã¨ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã®çµ„ã«ã—ã¦ãŠãï¼ˆcurrentCoordinates ãŒç„¡ã‘ã‚Œã°ã‚³ãƒ”ãƒ¼ã¯ç„¡è¦–ã•ã‚Œã‚‹ï¼‰ -->
                <button class="coordinate-text" id="coordinateText" onclick="copyCoordinates()">åº§æ¨™ã‚’å–å¾—ã™ã‚‹ã«ã¯ã€ç”»åƒä¸Šã§ãƒˆãƒªãƒŸãƒ³ã‚°ç¯„å›²ã‚’é¸æŠã—ã¦ãã ã•ã„</button>
                <button class="toggle-btn copy-btn" id="copyBtn" onclick="copyCoordinates()">ã‚³ãƒ”ãƒ¼</button>
            </div>
        </div>

        <div class="result-images" id="resultImages">
            <div class="image-result">
                <h3>å…ƒç”»åƒ</h3>
                <img id="originalImage" alt="å…ƒç”»åƒ">
            </div>
            <div class="image-result">
                <h3>ãƒˆãƒªãƒŸãƒ³ã‚°çµæœ</h3>
                <img id="croppedImage" alt="ãƒˆãƒªãƒŸãƒ³ã‚°ç”»åƒ">
                <br>
                <button class="toggle-btn" id="downloadBtn">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
            </div>
        </div>
        <div class="instructions">
            <h3>åº§æ¨™ã®æ„å‘³</h3>
            <ul>
                <li><strong>l</strong> (left): å·¦ç«¯ã®xåº§æ¨™ - æ¨ªè»¸ <code>l = x</code></li>
                <li><strong>t</strong> (top): ä¸Šç«¯ã®yåº§æ¨™ - ç¸¦è»¸ <code>t = y</code></li>
                <li><strong>r</strong> (right): å³ç«¯ã®xåº§æ¨™ - æ¨ªè»¸ <code>r = x + w</code></li>
                <li><strong>b</strong> (bottom): ä¸‹ç«¯ã®yåº§æ¨™ - ç¸¦è»¸ <code>b = y + h</code></li>
            </ul>
        </div>
    </div>

    <script>
        let canvas, ctx;
        let img = new Image();
        let isDrawing = false;
        let startX, startY, endX, endY;
        let originalImageData;
        let currentCoordinates = null;

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            canvas = document.getElementById('imageCanvas');
            ctx = canvas.getContext('2d');
            setupEventListeners();
        });

        function setupEventListeners() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');

            // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });

            // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFile(e.target.files[0]);
                }
            });

            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);

            // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('cropBtn').addEventListener('click', cropImage);
            document.getElementById('resetBtn').addEventListener('click', resetAll);
            document.getElementById('downloadBtn').addEventListener('click', downloadCroppedImage);
        }

        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                img.onload = function() {
                    displayImage();
                    showControls();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function displayImage() {
            const maxWidth = 800;
            const maxHeight = 600;
            
            let { width, height } = img;
            
            // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’ä¿æŒã—ã¦ãƒªã‚µã‚¤ã‚º
            if (width > maxWidth || height > maxHeight) {
                const ratio = Math.min(maxWidth / width, maxHeight / height);
                width *= ratio;
                height *= ratio;
            }

            canvas.width = width;
            canvas.height = height;
            
            ctx.drawImage(img, 0, 0, width, height);
            originalImageData = ctx.getImageData(0, 0, width, height);

            // å…ƒç”»åƒã‚’çµæœã‚¨ãƒªã‚¢ã«è¡¨ç¤º
            document.getElementById('originalImage').src = img.src;
        }

        function showControls() {
            document.getElementById('canvasContainer').style.display = 'block';
            document.getElementById('controls').style.display = 'flex';
            document.getElementById('infoPanel').style.display = 'block';
        }

        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            return {
                x: (e.clientX - rect.left) * scaleX,
                y: (e.clientY - rect.top) * scaleY
            };
        }

        function startDrawing(e) {
            isDrawing = true;
            const pos = getMousePos(e);
            startX = pos.x;
            startY = pos.y;
        }

        function draw(e) {
            if (!isDrawing) return;

            const pos = getMousePos(e);
            endX = pos.x;
            endY = pos.y;

            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢
            ctx.putImageData(originalImageData, 0, 0);

            // é¸æŠç¯„å›²ã‚’æç”»
            ctx.strokeStyle = '#ff4444';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.strokeRect(startX, startY, endX - startX, endY - startY);

            // åº§æ¨™ã‚’æ›´æ–°
            updateCoordinates();
        }

        function stopDrawing() {
            if (!isDrawing) return;
            isDrawing = false;
            document.getElementById('cropBtn').disabled = false;
        }

        function updateCoordinates() {
            // å®Ÿéš›ã®ç”»åƒã‚µã‚¤ã‚ºã«å¯¾ã™ã‚‹åº§æ¨™ã‚’è¨ˆç®—
            const scaleX = img.width / canvas.width;
            const scaleY = img.height / canvas.height;

            const x1 = Math.min(startX, endX) * scaleX;
            const y1 = Math.min(startY, endY) * scaleY;
            const x2 = Math.max(startX, endX) * scaleX;
            const y2 = Math.max(startY, endY) * scaleY;

            // [l, t, r, b] å½¢å¼ã®åº§æ¨™
            const l = Math.round(x1);  // left
            const t = Math.round(y1);  // top
            const r = Math.round(x2);  // right
            const b = Math.round(y2);  // bottom

            currentCoordinates = [l, t, r, b];

            const coordinateText = `[${l}, ${t}, ${r}, ${b}]`;
            // æ•°å€¤éƒ¨åˆ†ã‚’å¤§ããã—ã¦ã‚¯ãƒªãƒƒã‚¯ã§ã‚³ãƒ”ãƒ¼ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
            document.getElementById('coordinateDisplay').innerHTML =
                `<button class="coordinate-text" id="coordinateText" onclick="copyCoordinates()">${coordinateText}</button>` +
                `<button class="toggle-btn copy-btn" id="copyBtn" onclick="copyCoordinates()">ã‚³ãƒ”ãƒ¼</button>`;
        }

        function copyCoordinates() {
            if (!currentCoordinates) return;

            const coordinateText = `[${currentCoordinates[0]}, ${currentCoordinates[1]}, ${currentCoordinates[2]}, ${currentCoordinates[3]}]`;
            
            navigator.clipboard.writeText(coordinateText).then(() => {
                const copyBtn = document.getElementById('copyBtn');
                const coordinateTextBtn = document.getElementById('coordinateText');

                if (copyBtn) {
                    copyBtn.textContent = 'ã‚³ãƒ”ãƒ¼å®Œäº†!';
                    copyBtn.classList.add('copy-success');
                }
                if (coordinateTextBtn) {
                    coordinateTextBtn.classList.add('copy-success');
                    // æ•°å€¤éƒ¨åˆ†ã¯æ—¢ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãŒå¿µã®ãŸã‚æ­£ã—ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚»ãƒƒãƒˆ
                    coordinateTextBtn.textContent = coordinateText;
                }

                setTimeout(() => {
                    if (copyBtn) {
                        copyBtn.textContent = 'ã‚³ãƒ”ãƒ¼';
                        copyBtn.classList.remove('copy-success');
                    }
                    if (coordinateTextBtn) {
                        coordinateTextBtn.classList.remove('copy-success');
                    }
                }, 2000);
            });
        }

        let croppedCanvas = null; // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦è¿½åŠ 

        function cropImage() {
            if (!currentCoordinates) return;

            const [l, t, r, b] = currentCoordinates;
            const w = r - l;  // width
            const h = b - t;  // height

            // æ–°ã—ã„ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ä½œæˆã—ã¦ãƒˆãƒªãƒŸãƒ³ã‚°
            croppedCanvas = document.createElement('canvas');
            const tempCtx = croppedCanvas.getContext('2d');
            
            croppedCanvas.width = w;
            croppedCanvas.height = h;

            tempCtx.drawImage(img, l, t, w, h, 0, 0, w, h);

            // çµæœã‚’è¡¨ç¤º
            const croppedImage = document.getElementById('croppedImage');
            croppedImage.src = croppedCanvas.toDataURL();
            
            document.getElementById('resultImages').style.display = 'grid';
        }

        // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’ç‹¬ç«‹ã—ãŸé–¢æ•°ã¨ã—ã¦å®šç¾©
        function downloadCroppedImage() {
            if (!croppedCanvas) {
                alert('ã¾ãšãƒˆãƒªãƒŸãƒ³ã‚°ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            try {
                const link = document.createElement('a');
                link.download = 'cropped_image.png';
                link.href = croppedCanvas.toDataURL('image/png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (error) {
                console.error('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
                alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        }

        function resetAll() {
            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢
            if (originalImageData) {
                ctx.putImageData(originalImageData, 0, 0);
            }
            
            // å¤‰æ•°ã‚’ãƒªã‚»ãƒƒãƒˆ
            isDrawing = false;
            currentCoordinates = null;
            croppedCanvas = null; // ãƒˆãƒªãƒŸãƒ³ã‚°æ¸ˆã¿ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚‚ãƒªã‚»ãƒƒãƒˆ
            
            // UI ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('cropBtn').disabled = true;
            document.getElementById('coordinateDisplay').innerHTML =
                `<button class="coordinate-text" id="coordinateText" onclick="copyCoordinates()">åº§æ¨™ã‚’å–å¾—ã™ã‚‹ã«ã¯ã€ç”»åƒä¸Šã§ãƒˆãƒªãƒŸãƒ³ã‚°ç¯„å›²ã‚’é¸æŠã—ã¦ãã ã•ã„</button>` +
                `<button class="toggle-btn copy-btn" id="copyBtn" onclick="copyCoordinates()">ã‚³ãƒ”ãƒ¼</button>`;
            document.getElementById('resultImages').style.display = 'none';
        }
    </script>
